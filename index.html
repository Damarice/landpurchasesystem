<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<link rel="stylesheet" href="style.css">
<title>Land Purchase System â€“ 200 Plots</title>

</head>
<body>

<!-- ============================================
     HEADER SECTION
     ============================================ -->
<header>
  <div>
    <h1>Land Purchase System</h1>
    <div class="meta">
      <strong>200 plots</strong> available at 
      <strong id="priceReadable">KES 65,800</strong> per plot
      <span style="color: var(--text-muted)">Â· Demo Mode</span>
    </div>
  </div>
  <div class="controls">
    <button id="clearSelection" class="ghost" disabled>Clear Selection</button>
    <button id="resetDemo" class="ghost">Reset Demo</button>
    <a href="admin.html" class="ghost" style="text-decoration:none"><button class="ghost">Admin</button></a>
  </div>
</header>

<!-- ============================================
     MAIN LAYOUT: MAP + SIDEBAR
     ============================================ -->
<div class="layout">
  
  <!-- LEFT SIDE: LAND PARCEL MAP -->
  <div class="map">
    <div class="map-header">
      <div class="map-title">Land Parcel Grid</div>
      <div class="view-controls">
        <button id="zoomOut" class="ghost">âˆ’</button>
        <button id="zoomIn" class="ghost">+</button>
      </div>
    </div>
    
    <!-- Bulk selection tools -->
    <div class="bulk-actions">
      <button id="selectAvailable" class="ghost">Select All Available</button>
      <button id="selectRange" class="ghost">Select Range</button>
    </div>
    
    <!-- Plot grid container -->
    <div class="grid-wrapper">
      <div class="grid" id="grid"></div>
    </div>
    
    <!-- User hint -->
    <div style="margin-top: 16px; font-size: 13px; color: var(--text-muted);">
      ðŸ’¡ <strong>Tip:</strong> Click plots to select, hold Shift to select multiple, or use bulk actions above
    </div>
  </div>

  <!-- RIGHT SIDE: SIDEBAR WITH FORMS & INFO -->
  <aside class="sidebar">
    
    <!-- Statistics Cards -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-label">Available</div>
        <div class="stat-value" id="availableCount">0</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Sold</div>
        <div class="stat-value" id="soldCount">0</div>
      </div>
    </div>

    <!-- Buyer Information Form -->
    <div class="buyer-section">
      <div class="buyer-header">ðŸ‘¤ Buyer Information</div>
      
      <div class="form-group">
        <label>Full Name *</label>
        <input type="text" id="buyerName" placeholder="Enter buyer's full name" />
      </div>
      
      <div class="form-group">
        <label>Phone Number *</label>
        <input type="tel" id="buyerPhone" placeholder="e.g., +254712345678" />
      </div>
      
      <div class="form-group">
        <label>ID Number *</label>
        <input type="text" id="buyerID" placeholder="e.g., 12345678" />
      </div>
    </div></div>

    <!-- Selection Summary Card -->
    <div class="selection-summary" id="summaryCard">
      <div class="selection-title">Current Selection</div>
      <div class="selection-cost" id="selectedCost">KES 0</div>
      <div class="selection-plots" id="selectedInfo">No plots selected</div>
    </div>

    <!-- Payment Options -->
    <div class="buyer-section" id="paymentSection">
      <div class="buyer-header">ðŸ’³ Payment Options</div>

      <div class="form-group">
        <label>Payment Mode *</label>
        <div class="inline">
          <label style="margin-right: 12px;">
            <input type="radio" name="paymentMode" id="paymentModeFull" value="full" checked /> Pay in Full
          </label>
          <label>
            <input type="radio" name="paymentMode" id="paymentModeInstallments" value="installments" /> Pay in Installments
          </label>
        </div>
      </div>

      <div id="installmentFields" style="display:none">
        <div class="form-group">
          <label>Deposit</label>
          <div class="inline">
            <label style="margin-right: 8px;">
              <input type="radio" name="depositType" id="depositTypePercent" value="percent" checked /> %
            </label>
            <label>
              <input type="radio" name="depositType" id="depositTypeAmount" value="amount" /> Amount
            </label>
          </div>
          <div class="inline" style="margin-top: 6px; gap: 8px; align-items: center;">
            <input type="number" id="depositPercent" min="0" max="100" step="1" placeholder="e.g., 30" style="width: 110px;" />
            <span style="color: var(--text-muted); font-size: 12px;">or</span>
            <input type="number" id="depositAmount" min="0" step="100" placeholder="e.g., 10000" style="width: 150px;" />
          </div>
          <div id="depositHelper" style="margin-top: 4px; font-size: 12px; color: var(--text-muted);"></div>
        </div>

        <div class="form-group">
          <label>Number of Installments (months) *</label>
          <input type="number" id="installmentMonths" min="2" max="60" step="1" placeholder="e.g., 12" />
        </div>

        <div class="form-group">
          <label>Start Date</label>
          <input type="date" id="installmentStartDate" />
        </div>

        <div class="budget-display" id="installmentSummary" style="display:none">
          <div>
            <div class="budget-label">Estimated Monthly Payment</div>
            <div class="budget-amount" id="monthlyAmount">KES 0</div>
          </div>
          <div>
            <div class="budget-label">Deposit Payable Now</div>
            <div class="budget-amount" id="depositPayable">KES 0</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Special Requirements Textarea -->
    <label>
      Purchase Purpose & Special Requirements
      <textarea 
        id="bespokeNote" 
        placeholder="e.g., Purpose: Residential development. Payment: 30% deposit, 70% over 12 months. Requirements: Corner plots with road access, near amenities..."
      ></textarea>
    </label>

    <!-- Purchase Button -->
    <div class="action-group">
      <button id="buyBtn" disabled>Complete Purchase</button>
    </div>

    <!-- Plot Status Legend -->
    <div class="legend">
      <div class="legend-item">
        <div class="legend-color" style="background: linear-gradient(135deg, #3b82f6 0%, #60a5fa 100%); border: 1px solid rgba(255,255,255,.2);"></div>
        <span>Available</span>
      </div>
      <div class="legend-item">
        <div class="legend-color" style="background: linear-gradient(135deg, #fbbf24 0%, #fcd34d 100%); border: 2px solid #f59e0b;"></div>
        <span>Selected</span>
      </div>
      <div class="legend-item">
        <div class="legend-color" style="background: linear-gradient(135deg, #16a34a 0%, #22c55e 100%);"></div>
        <span>Sold</span>
      </div>
    </div>

    <!-- Transaction History Log -->
    <div class="log-section">
      <div class="log-header">
        <span>Transaction History</span>
        <button id="clearLog" class="ghost" style="padding: 4px 8px; font-size: 11px;">Clear</button>
      </div>
      <div class="log-container" id="logContainer">
        <div class="log-empty">No transactions yet</div>
      </div>
    </div>

    <!-- Payments Panel -->
    <div class="buyer-section" id="paymentsPanel">
      <div class="buyer-header">ðŸ’° Record Payment</div>
      <div class="form-group">
        <label>Transaction ID *</label>
        <input type="number" id="payTransactionId" placeholder="e.g., 123" />
      </div>
      <div class="form-group">
        <button class="ghost" id="loadTransactionBtn">Load Transaction</button>
      </div>
      <div class="budget-display" id="paymentSummary" style="display:none">
        <div>
          <div class="budget-label">Total Amount</div>
          <div class="budget-amount" id="payTotalAmount">KES 0</div>
        </div>
        <div>
          <div class="budget-label">Total Paid</div>
          <div class="budget-amount" id="payTotalPaid">KES 0</div>
        </div>
        <div>
          <div class="budget-label">Remaining Balance</div>
          <div class="budget-amount" id="payRemaining">KES 0</div>
        </div>
      </div>
      <div class="form-group">
        <label>Amount *</label>
        <input type="number" id="payAmount" min="0" step="100" placeholder="e.g., 20000" />
      </div>
      <div class="form-group">
        <label>Method</label>
        <select id="payMethod">
          <option value="cash">Cash</option>
          <option value="mpesa">M-Pesa</option>
          <option value="card">Card</option>
          <option value="bank">Bank</option>
        </select>
      </div>
      <div class="form-group">
        <label>Reference</label>
        <input type="text" id="payReference" placeholder="e.g., MPESA-XYZ123" />
      </div>
      <div class="form-group">
        <label>Payment Date</label>
        <input type="date" id="payDate" />
      </div>
      <div class="action-group">
        <button id="recordPaymentBtn" disabled>Record Payment</button>
      </div>
      <div class="log-section" style="margin-top: 8px;">
        <div class="log-header"><span>Payments</span></div>
        <div class="log-container" id="paymentsList"><div class="log-empty">No payments loaded</div></div>
      </div>
    </div>

    <!-- Buyer Balance Panel -->
    <div class="buyer-section" id="buyerBalancePanel">
      <div class="buyer-header">ðŸ“Š Buyer Balance</div>
      <div class="form-group">
        <label>Buyer ID Number *</label>
        <input type="text" id="balanceBuyerIdNumber" placeholder="e.g., 12345678" />
      </div>
      <div class="form-group">
        <button class="ghost" id="loadBuyerBalanceBtn">Load Balance</button>
      </div>
      <div class="log-section" style="margin-top: 8px;">
        <div class="log-header"><span>Transactions</span></div>
        <div class="log-container" id="buyerBalanceList"><div class="log-empty">No data</div></div>
      </div>
    </div>

    <!-- Payment Summary Report Panel -->
    <div class="buyer-section" id="paymentSummaryPanel">
      <div class="buyer-header">ðŸ“Š Payment Summary Report</div>
      <div class="form-group">
        <button class="ghost" id="generateReportBtn">Generate Report</button>
      </div>
      
      <!-- Summary Statistics -->
      <div class="stats-grid" id="reportStats" style="display:none; margin-top: 12px;">
        <div class="stat-card">
          <div class="stat-label">Total Sales</div>
          <div class="stat-value" id="totalSalesAmount">KES 0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Total Paid</div>
          <div class="stat-value" id="totalPaidAmount">KES 0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Outstanding</div>
          <div class="stat-value" id="totalOutstandingAmount">KES 0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Plots Sold</div>
          <div class="stat-value" id="totalPlotsSold">0</div>
        </div>
      </div>
      
      <!-- Detailed Report -->
      <div class="log-section" style="margin-top: 8px;">
        <div class="log-header">
          <span>Payment Details</span>
          <button id="exportReportBtn" class="ghost" style="padding: 4px 8px; font-size: 11px; display:none;">Export</button>
        </div>
        <div class="log-container" id="paymentReportList"><div class="log-empty">Click Generate Report</div></div>
      </div>
    </div>

    <!-- Footer Notice -->
    <footer>
      <strong>Demo Mode Notice:</strong> This is a prototype interface. For production deployment, integrate: KYC verification, secure payment gateway, legal title registry, and escrow services.
    </footer>
  </aside>
</div>

<!-- Toast container -->
<div id="toast" class="toast" aria-live="polite" aria-atomic="true" role="status" style="display:none">âœ“ Purchase sent successfully</div>

<script>
  window.API_BASE_URL = 'https://landpurchasesystem.onrender.com/api';
</script>
<script src="api-client.js"></script>
<script src="app-backend.js"></script>

</body>
</html>